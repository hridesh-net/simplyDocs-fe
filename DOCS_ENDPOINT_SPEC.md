# Documentation Endpoints Specification

## Current Implementation

The frontend expects two endpoints for documentation:

### 1. Generate Documentation
**Endpoint:** `POST /repos/process`

**Request:**
```json
{
  "github_url": "https://github.com/DataTalksClub/data-engineering-zoomcamp.git"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Documentation generated successfully"
}
```

**Status:** ‚úÖ Implemented

---

### 2. Get Documentation List
**Endpoint:** `GET /repo_docs/`

**Headers:**
```
Authorization: Bearer <jwt_token>
```

**Actual Response:**
```json
[
  {
    "slug": "after-sign-up-e43c84ea",
    "title": "After Sign Up",
    "html_path": "generated_docs\\619d3749-3688-4f05-aa36-8635283ffdc2\\.\\after-sign-up.html",
    "user_id": 1,
    "id": 1,
    "description": "Generated from after-sign-up.md",
    "created_at": "2025-12-18T03:54:45.266647"
  }
]
```

**Status:** ‚úÖ Implemented

**Backend Implementation Suggestions:**

1. **Store Generated Docs Metadata**
   - After processing a repo, store metadata in database:
     - Document ID
     - Title (extracted from file name or content)
     - Description (first paragraph or summary)
     - Slug (URL-friendly identifier)
     - Last updated timestamp
     - User ID (who generated it)
     - Repository URL

2. **Query by User**
   - Return only docs generated by the authenticated user
   - Or return all docs if it's a shared documentation system

3. **Sorting**
   - Sort by `last_updated` descending (newest first)

---

### 3. Get Individual Document
**Endpoint:** `GET /repo_docs/{slug}`

**Headers:**
```
Authorization: Bearer <jwt_token>
```

**Expected Response:**
Raw HTML content (not JSON):
```html
<h1>After Sign Up</h1>
<p>This document explains what to do after signing up...</p>
<h2>Next Steps</h2>
<p>Complete your profile and verify your email.</p>
```

**Status:** ‚è≥ Needs Backend Implementation

**Backend Implementation Suggestions:**

1. **Store HTML Content**
   - After processing repo, store generated HTML for each doc
   - Could be in database (TEXT/BLOB field) or file storage

2. **Retrieve by Slug**
   - Look up document by slug parameter
   - Verify user has access to this document
   - Return raw HTML content with `Content-Type: text/html`

---

## Individual Document Endpoint (Needs Implementation)

**Endpoint:** `GET /repo_docs/{slug}`

**Headers:**
```
Authorization: Bearer <jwt_token>
```

**Example Request:**
```
GET /repo_docs/after-sign-up-e43c84ea
```

**Expected Response:**
Raw HTML content (Content-Type: text/html):
```html
<h1>After Sign Up</h1>
<p>This document explains what to do after signing up...</p>
<h2>Next Steps</h2>
<ul>
  <li>Complete your profile</li>
  <li>Verify your email</li>
</ul>
```

**Backend Implementation:**
1. Find document by slug in database
2. Verify user has access to this document (user_id matches)
3. Read HTML content from `html_path` 
4. Return raw HTML with appropriate Content-Type header

**Error Responses:**
- 404: Document not found
- 403: User doesn't have access to this document
- 401: Invalid/missing token

## Current Backend Database Schema

```sql
CREATE TABLE documents (
    id VARCHAR(255) PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    repo_url VARCHAR(500) NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    slug VARCHAR(255) NOT NULL UNIQUE,
    html_content TEXT NOT NULL,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE INDEX idx_user_docs ON documents(user_id, last_updated DESC);
CREATE INDEX idx_slug ON documents(slug);
```

---

## Alternative Approach: File-Based Storage

If you prefer not to store HTML in database:

1. **Store HTML files on disk**
   ```
   /docs_storage/
     ‚îú‚îÄ‚îÄ user_123/
     ‚îÇ   ‚îú‚îÄ‚îÄ repo_abc/
     ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ introduction.html
     ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup.html
     ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metadata.json
   ```

2. **Store only metadata in database**
   ```json
   {
     "id": "doc_123",
     "user_id": "user_123",
     "repo_url": "https://github.com/...",
     "slug": "introduction",
     "file_path": "/docs_storage/user_123/repo_abc/introduction.html",
     "title": "Introduction",
     "description": "...",
     "last_updated": "2025-12-10T10:15:00Z"
   }
   ```

3. **Serve files dynamically**
   - GET /api/docs ‚Üí Query database for metadata
   - GET /api/docs/{slug} ‚Üí Read HTML file from disk

---

## Frontend Integration Points

The frontend is already set up to handle these endpoints:

**DocsListPage.js:**
```javascript
const data = await docsAPI.getDocsList();
setDocs(data); // Expects array of doc objects
```

**DocViewerPage.js:**
```javascript
const htmlContent = await docsAPI.getDoc(slug);
// Expects raw HTML string
// Renders with dangerouslySetInnerHTML
```

Once you implement these two endpoints, the frontend will work seamlessly! üöÄ

---

## Testing Checklist

- [ ] POST /repos/process generates docs and stores metadata
- [ ] GET /api/docs returns list of user's documents
- [ ] GET /api/docs/{slug} returns HTML content for specific doc
- [ ] Authorization works for all endpoints
- [ ] CORS configured for frontend origin
- [ ] Error handling for missing/unauthorized docs